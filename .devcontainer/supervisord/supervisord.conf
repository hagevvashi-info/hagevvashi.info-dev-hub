[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[inet_http_server]
port=*:9001
username=admin
password=admin

[supervisord]
nodaemon=true
user=root
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/var/run/supervisord.pid

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# ========================================
# 初期化処理
# ========================================

[program:docker-entrypoint]
command=/usr/local/bin/docker-entrypoint.sh
user=hagevvashi
autostart=true
autorestart=false
startsecs=0
priority=1
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# ========================================
# 安定稼働が必要なサービス
# ========================================

[program:code-server]
command=/home/hagevvashi/.local/bin/code-server --bind-addr 0.0.0.0:4035 --auth password
user=hagevvashi
directory=/home/hagevvashi/hagevvashi.info-dev-hub
autostart=true
autorestart=false
priority=10
environment=CODE_SERVER_PORT="4035",HOME="/home/hagevvashi"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# ========================================
# 開発ツール（オプション）
# ========================================

# process-compose（TUIでプロセス管理）
# 必要なときだけ手動起動
[program:process-compose]
command=/usr/local/bin/process-compose -f /etc/process-compose/process-compose.yaml
user=hagevvashi
directory=/home/hagevvashi/hagevvashi.info-dev-hub
autostart=false
autorestart=false
priority=20
environment=HOME="/home/hagevvashi"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# difit（直接supervisordで管理する場合）
[program:difit]
command=/home/hagevvashi/.asdf/shims/difit
user=hagevvashi
directory=/home/hagevvashi/hagevvashi.info-dev-hub
autostart=false
autorestart=false
priority=20
environment=HOME="/home/hagevvashi"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0